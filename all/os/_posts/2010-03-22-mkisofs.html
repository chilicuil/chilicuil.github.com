---
layout: post
title: "mkisofs"
---

<h2>{{ page.title }}</h2>

<p class="publish_date">22 Mar 2010</p>

<p align="justify">Entonces estaba en clase de sistemas operativos, y no encontraba información sobre como generar imagenes .iso a partir de kernels no tradicionales, asi que deje algo aquí para mi propia referencia:
</p>

<pre class="sh_sh">
    $ mkdir luxur
    $ cd luxur
    $ wget http://downloads.sourceforge.net/project/luxur/luxur0.0.1/
           Luxur-src.tar.gz?use_mirror=cdnetworks-us-2  -O Luxur-src.tar.gz
</pre>

<p align="justify">Descomprimiendo...
</p>

<pre class="sh_sh">
    $ tar zxvf Luxur-src.tar.gz
</pre>

<p align="justify">Después de lo cual se podran ver los siguientes archivos:
</p>

<pre class="sh_sh">
    $ ls
    boot  COPYING  include  kernel  lib  link.ld  Luxur-src.tar.gz  Makefile
</pre>

<p align="justify">Se compila:
</p>

<pre class="sh_sh">
    $ make
</pre>

<p align="justify">Lo que debería provocar que apareceriera <strong>Luxur</strong>, que es el binario que me interesa (kernel)
</p>

<pre class="sh_sh">
    $ ls
    boot  COPYING  include  kernel  lib  link.ld  Luxur  Luxur-src.tar.gz  Makefile
</pre>

<p align="justify">Una vez hecho esto, se crea la estructura básica:
</p>

<pre class="sh_sh">
    $ cd ~
    $ mkdir -vp iso/boot/grub
    mkdir: created directory `iso'
    mkdir: created directory `iso/boot'
    mkdir: created directory `iso/boot/grub'
</pre>

<p align="justify">Después de lo cual se agrega el archivo <strong>menu.lst</strong> a <strong>iso/boot/menu</strong> con el siguiente contenido:
</p>

<pre class="sh_sh">
    $ cat b/boot/grub/menu.lst
    title		Luxur
    kernel    /boot/Luxur
</pre>

<p align="justify">Terminado se agrega el archivo <strong>stage2_eltorito</strong> a <strong>iso/boot/grub</strong> (este es el que hace la magia para que un disco comun y corriente sea autoarrancable)
</p>

<p align="justify">En un sistema con grub legacy y arquitectura x86:
</p>

<pre class="sh_sh">
    $ cp /usr/lib/grub/i386-pc/stage2_eltorito  iso/boot/grub
</pre>

<p align="justify">En un sistema con grub legacy y arquitectura amd64:
</p>

<pre class="sh_sh">
    $  /usr/lib/grub/x86_64-pc/stage2_eltorito  iso/boot/grub
</pre>

<p align="justify">NOTA: Una copia del archivo '<span style="color: rgb(0, 0, 205);">stage2_eltorito</span>' se encuentra disponible aqui: <br><br>
<a href="http://arabos.googlecode.com/files/stage2_eltorito" target="_blank">http://arabos.googlecode.com/files/stage2_eltorito</a>
</p>

<p align="justify">Y por ultimo el kernel a iso/boot/
</p>

<pre class="sh_sh">
    $ cp luxur/Luxur   iso/boot/
</pre>

<p align="justify">Se crea el iso:
</p>

<pre class="sh_sh">
    $ mkisofs -R -b boot/grub/stage2_eltorito -no-emul-boot -boot-load-size 4 \
      -boot-info-table -o imagen.iso iso
</pre>

<p align="justify">Esta ultima linea la copie de la documentacion del grub: <a href="http://tinyurl.com/cr7xx" target="_blank">http://tinyurl.com/cr7xx</a>
</p>

<p align="justify">Aunque los chicos de #grub me han dicho que tambien se deberia poder con grub2,
usando '<strong>grub-mkrescue</strong>'..., abria que probar porque esta ultima opcion ya no la
use.
</p>

<p align="justify" Se obtiene una salida parecida a esta:
</p>

<pre class="sh_log">
    I: -input-charset not specified, using utf-8 (detected in locale settings)
    Size of boot image is 4 sectors -> No emulation
    Total translation table size: 2048
    Total rockridge attributes bytes: 917
    Total directory bytes: 4096
    Path table size(bytes): 34
    Max brk space used 0
    247 extents written (0 MB)
</pre>

<p align="justify">ahora deberia existir un archivo 'imagen.iso' que se puede usar con 
qemu/vbox/wmware
</p>
